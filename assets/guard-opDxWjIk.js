import{o as i,g as a}from"./auth-Tfpdhhiz.js";const r={A1:0,A2:1,B1:2,B2:3,C1:4};function s(){const e=window.location.pathname;return e.includes("login.html")?"login":e.includes("placement-test.html")?"placement":e.includes("dashboard.html")?"dashboard":e.includes("/lessons/")?"lesson":"protected"}function c(){const n=window.location.pathname.match(/\/lessons\/([^/]+)\//);return n?n[1].toUpperCase():null}function l(e,n){const t=r[e]||0;return(r[n]||0)<=t}function u(){const e=s();i(async n=>{if(!n){e!=="login"&&(window.location.href="/login.html");return}let t=await a(n.uid);if(t||(console.warn("User document not found, retrying in 1s..."),await new Promise(o=>setTimeout(o,1e3)),t=await a(n.uid)),!t){console.warn("User document still missing. Attempting to auto-create...");try{await createUserDocument(n,"email"),t=await a(n.uid)}catch(o){console.error("Failed to auto-create user doc:",o)}}if(!t){if(e!=="login"&&e!=="placement"){console.error("CRITICAL: User document could not be created/found."),alert("Account Error: User profile missing. Please try logging out and back in.");return}return}if(e==="login"){t.hasPlacement?window.location.href="/dashboard.html":window.location.href="/placement-test.html";return}if(e==="placement"){t.hasPlacement&&(window.location.href="/dashboard.html");return}if(e==="dashboard"||e==="lesson"||e==="protected"){if(!t.hasPlacement){window.location.href="/placement-test.html";return}if(e==="lesson"){const o=c();if(o&&!l(t.level,o)){sessionStorage.setItem("accessDeniedMessage",`You cannot access ${o} lessons yet. Complete your current level first!`),window.location.href="/dashboard.html";return}}}window.dispatchEvent(new CustomEvent("userReady",{detail:t}))})}function m(){u()}export{m as r};
