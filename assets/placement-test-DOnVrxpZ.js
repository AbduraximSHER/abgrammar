import{a as w,d as q,o as A,g as B}from"./auth-Tfpdhhiz.js";/* empty css                       */import{doc as C,setDoc as E,serverTimestamp as S}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";import{r as T}from"./guard-opDxWjIk.js";import"https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";const m=[{id:"a1_1",level:"A1",skill:"grammar",question:"She ___ a student.",choices:["am","is","are","be"],correctIndex:1,explain:'"She" takes "is" as the verb to be.'},{id:"a1_2",level:"A1",skill:"grammar",question:"I ___ from Japan.",choices:["is","am","are","be"],correctIndex:1,explain:'"I" always takes "am".'},{id:"a1_3",level:"A1",skill:"grammar",question:"They ___ happy.",choices:["is","am","are","be"],correctIndex:2,explain:'"They" takes "are".'},{id:"a1_4",level:"A1",skill:"vocabulary",question:'What is the opposite of "hot"?',choices:["warm","cold","big","fast"],correctIndex:1,explain:"Cold is the opposite of hot."},{id:"a1_5",level:"A1",skill:"vocabulary",question:'A "cat" is a...',choices:["fruit","animal","color","number"],correctIndex:1,explain:"A cat is an animal."},{id:"a1_6",level:"A1",skill:"vocabulary",question:"How many days are in a week?",choices:["5","6","7","8"],correctIndex:2,explain:"There are 7 days in a week."},{id:"a1_7",level:"A1",skill:"grammar",question:"This is ___ apple.",choices:["a","an","the","some"],correctIndex:1,explain:'Use "an" before vowel sounds.'},{id:"a1_8",level:"A1",skill:"grammar",question:"He ___ like coffee.",choices:["don't","doesn't","isn't","aren't"],correctIndex:1,explain:`"He" uses "doesn't" for negative.`},{id:"a1_9",level:"A1",skill:"reading",question:'"My name is Tom. I am 10 years old." How old is Tom?',choices:["5","10","15","20"],correctIndex:1,explain:"The text says Tom is 10 years old."},{id:"a1_10",level:"A1",skill:"vocabulary",question:"What color is the sky?",choices:["red","green","blue","yellow"],correctIndex:2,explain:"The sky is blue."},{id:"a1_11",level:"A1",skill:"grammar",question:"___ you speak English?",choices:["Do","Does","Is","Are"],correctIndex:0,explain:'"You" takes "Do" in questions.'},{id:"a1_12",level:"A1",skill:"reading",question:'"I have two cats and one dog." How many pets in total?',choices:["1","2","3","4"],correctIndex:2,explain:"2 cats + 1 dog = 3 pets."},{id:"a2_1",level:"A2",skill:"grammar",question:"She ___ to school every day.",choices:["go","goes","going","gone"],correctIndex:1,explain:'Third person singular uses "goes".'},{id:"a2_2",level:"A2",skill:"grammar",question:"I ___ my homework yesterday.",choices:["do","did","done","doing"],correctIndex:1,explain:'"Yesterday" requires past tense "did".'},{id:"a2_3",level:"A2",skill:"grammar",question:"There ___ many people at the party.",choices:["was","were","is","be"],correctIndex:1,explain:'"People" is plural, so use "were".'},{id:"a2_4",level:"A2",skill:"vocabulary",question:'To "purchase" means to...',choices:["sell","buy","give","take"],correctIndex:1,explain:"Purchase means to buy."},{id:"a2_5",level:"A2",skill:"vocabulary",question:"What do you call the room where you cook?",choices:["bedroom","bathroom","kitchen","living room"],correctIndex:2,explain:"The kitchen is where you cook."},{id:"a2_6",level:"A2",skill:"grammar",question:"We ___ to the cinema last night.",choices:["go","goes","went","going"],correctIndex:2,explain:'"Last night" requires past tense "went".'},{id:"a2_7",level:"A2",skill:"reading",question:'"The train leaves at 9 AM." When does the train leave?',choices:["8 AM","9 AM","10 AM","11 AM"],correctIndex:1,explain:"The text states 9 AM."},{id:"a2_8",level:"A2",skill:"vocabulary",question:'"Cheap" is the opposite of...',choices:["small","expensive","old","slow"],correctIndex:1,explain:"Expensive is the opposite of cheap."},{id:"a2_9",level:"A2",skill:"grammar",question:"I have ___ been to Paris.",choices:["ever","never","always","yet"],correctIndex:1,explain:'"Never" indicates no experience.'},{id:"a2_10",level:"A2",skill:"grammar",question:"She is ___ than her brother.",choices:["tall","taller","tallest","more tall"],correctIndex:1,explain:'Comparative form is "taller".'},{id:"a2_11",level:"A2",skill:"reading",question:'"Please close the door." What should you do?',choices:["Open the door","Lock the door","Close the door","Break the door"],correctIndex:2,explain:"The instruction says to close it."},{id:"a2_12",level:"A2",skill:"vocabulary",question:"A person who teaches is called a...",choices:["doctor","teacher","driver","singer"],correctIndex:1,explain:"A teacher teaches students."},{id:"b1_1",level:"B1",skill:"grammar",question:"If I ___ rich, I would travel the world.",choices:["am","was","were","be"],correctIndex:2,explain:'Second conditional uses "were".'},{id:"b1_2",level:"B1",skill:"grammar",question:"She has been working here ___ 2015.",choices:["for","since","from","during"],correctIndex:1,explain:'"Since" is used with specific times.'},{id:"b1_3",level:"B1",skill:"grammar",question:"The book ___ by millions of people.",choices:["read","reads","is read","reading"],correctIndex:2,explain:'Passive voice: "is read".'},{id:"b1_4",level:"B1",skill:"vocabulary",question:'"To postpone" means to...',choices:["cancel","delay","start","finish"],correctIndex:1,explain:"Postpone means to delay."},{id:"b1_5",level:"B1",skill:"vocabulary",question:'Someone who is "ambitious" wants to...',choices:["sleep","succeed","fail","relax"],correctIndex:1,explain:"Ambitious people want success."},{id:"b1_6",level:"B1",skill:"grammar",question:"I wish I ___ more time to study.",choices:["have","has","had","having"],correctIndex:2,explain:'"Wish" takes past tense "had".'},{id:"b1_7",level:"B1",skill:"reading",question:'"Despite the rain, we continued." What happened?',choices:["We stopped","We continued","We ran","We slept"],correctIndex:1,explain:'"Despite" shows contrast; we continued.'},{id:"b1_8",level:"B1",skill:"grammar",question:"He asked me what I ___ doing.",choices:["am","was","is","were"],correctIndex:1,explain:"Reported speech uses past tense."},{id:"b1_9",level:"B1",skill:"vocabulary",question:'A "decade" is...',choices:["5 years","10 years","50 years","100 years"],correctIndex:1,explain:"A decade is 10 years."},{id:"b1_10",level:"B1",skill:"grammar",question:"She suggested ___ to the beach.",choices:["go","to go","going","went"],correctIndex:2,explain:'"Suggest" takes gerund (-ing).'},{id:"b1_11",level:"B1",skill:"reading",question:'"He apologized for being late." Why did he apologize?',choices:["He was early","He was late","He was sick","He was tired"],correctIndex:1,explain:"He apologized for lateness."},{id:"b1_12",level:"B1",skill:"vocabulary",question:'"To hesitate" means to...',choices:["pause","run","shout","sleep"],correctIndex:0,explain:"Hesitate means to pause before acting."},{id:"b2_1",level:"B2",skill:"grammar",question:"Had I known earlier, I ___ differently.",choices:["would act","would have acted","will act","acted"],correctIndex:1,explain:'Third conditional: "would have + past participle".'},{id:"b2_2",level:"B2",skill:"grammar",question:"The project, ___ was very complex, was completed on time.",choices:["that","which","who","what"],correctIndex:1,explain:'Non-defining relative clause uses "which".'},{id:"b2_3",level:"B2",skill:"vocabulary",question:'"Ubiquitous" means...',choices:["rare","everywhere","expensive","small"],correctIndex:1,explain:"Ubiquitous means present everywhere."},{id:"b2_4",level:"B2",skill:"grammar",question:"Not only ___ late, but he also forgot the documents.",choices:["he was","was he","he is","is he"],correctIndex:1,explain:'Inversion after "Not only": "was he".'},{id:"b2_5",level:"B2",skill:"vocabulary",question:'"To scrutinize" means to...',choices:["ignore","examine closely","destroy","create"],correctIndex:1,explain:"Scrutinize means to examine carefully."},{id:"b2_6",level:"B2",skill:"reading",question:'"The findings were inconclusive." What does this mean?',choices:["They proved everything","They proved nothing definite","They were wrong","They were perfect"],correctIndex:1,explain:"Inconclusive means not definitive."},{id:"b2_7",level:"B2",skill:"grammar",question:"It's high time you ___ studying seriously.",choices:["start","started","starting","to start"],correctIndex:1,explain:'"High time" takes past tense "started".'},{id:"b2_8",level:"B2",skill:"vocabulary",question:'A "paradox" is something that...',choices:["makes sense","seems contradictory","is simple","is loud"],correctIndex:1,explain:"A paradox seems contradictory but may be true."},{id:"b2_9",level:"B2",skill:"grammar",question:"She denied ___ the money.",choices:["to take","taking","took","take"],correctIndex:1,explain:'"Deny" takes gerund (-ing).'},{id:"b2_10",level:"B2",skill:"reading",question:'"The company faced unprecedented challenges." What kind?',choices:["Common","Never seen before","Easy","Small"],correctIndex:1,explain:"Unprecedented means never experienced before."},{id:"b2_11",level:"B2",skill:"vocabulary",question:'"Pragmatic" people are...',choices:["dreamy","practical","lazy","emotional"],correctIndex:1,explain:"Pragmatic means practical and realistic."},{id:"b2_12",level:"B2",skill:"grammar",question:"Hardly ___ arrived when it started raining.",choices:["I had","had I","I have","have I"],correctIndex:1,explain:'Inversion after "Hardly": "had I".'},{id:"c1_1",level:"C1",skill:"grammar",question:"___ it not for your help, I would have failed.",choices:["Was","Were","Had","If"],correctIndex:2,explain:'Formal inversion: "Had it not been for".'},{id:"c1_2",level:"C1",skill:"vocabulary",question:'"Ephemeral" describes something that is...',choices:["permanent","short-lived","large","quiet"],correctIndex:1,explain:"Ephemeral means lasting briefly."},{id:"c1_3",level:"C1",skill:"grammar",question:"The more you practice, ___ you become.",choices:["better","the better","best","the best"],correctIndex:1,explain:"Comparative correlative structure."},{id:"c1_4",level:"C1",skill:"vocabulary",question:'"To exacerbate" means to...',choices:["improve","worsen","explain","solve"],correctIndex:1,explain:"Exacerbate means to make worse."},{id:"c1_5",level:"C1",skill:"reading",question:'"The hypothesis was subsequently corroborated." What happened?',choices:["It was disproved","It was supported","It was ignored","It was changed"],correctIndex:1,explain:"Corroborated means confirmed/supported."},{id:"c1_6",level:"C1",skill:"grammar",question:"Seldom ___ such dedication to work.",choices:["I see","do I see","I do see","see I"],correctIndex:1,explain:'Inversion after "Seldom": "do I see".'},{id:"c1_7",level:"C1",skill:"vocabulary",question:'Something "pernicious" is...',choices:["helpful","harmful","colorful","peaceful"],correctIndex:1,explain:"Pernicious means subtly harmful."},{id:"c1_8",level:"C1",skill:"grammar",question:"It is imperative that she ___ on time.",choices:["arrives","arrive","arrived","arriving"],correctIndex:1,explain:'Subjunctive mood after "imperative that".'},{id:"c1_9",level:"C1",skill:"reading",question:'"His recalcitrant attitude hindered progress." What was he?',choices:["Cooperative","Stubborn","Happy","Quiet"],correctIndex:1,explain:"Recalcitrant means stubbornly defiant."},{id:"c1_10",level:"C1",skill:"vocabulary",question:'"To obviate" means to...',choices:["create","prevent","increase","describe"],correctIndex:1,explain:"Obviate means to prevent or avoid."},{id:"c1_11",level:"C1",skill:"grammar",question:"Under no circumstances ___ early.",choices:["we leave","should we leave","we should leave","leaving we"],correctIndex:1,explain:'Inversion after "Under no circumstances".'},{id:"c1_12",level:"C1",skill:"vocabulary",question:'"Obsequious" behavior is excessively...',choices:["rude","compliant","loud","slow"],correctIndex:1,explain:"Obsequious means overly eager to please."}],h=["A1","A2","B1","B2","C1"],u={A1:0,A2:1,B1:2,B2:3,C1:4};console.log("adaptiveTest.js - Module loading...");console.log("QUESTION_BANK type:",typeof m);console.log("QUESTION_BANK length:",m?m.length:"undefined");const I=12,v=18,_=6,L=4;class H{constructor(){this.currentLevel="B1",this.askedQuestionIds=new Set,this.answers=[],this.timeline=[],this.isComplete=!1,this.finalLevel=null,this.confidence=0,this.earlyStop=!1}getNextQuestion(){if(this.isComplete)return null;if(this.shouldStop())return this.isComplete=!0,this.calculateFinalLevel(),null;let t=this.getRandomQuestion(this.currentLevel);if(!t){const e=u[this.currentLevel];e>0&&(t=this.getRandomQuestion(h[e-1])),!t&&e<h.length-1&&(t=this.getRandomQuestion(h[e+1]))}return t||(this.isComplete=!0,this.calculateFinalLevel(),null)}getRandomQuestion(t){const e=m.filter(n=>n.level===t&&!this.askedQuestionIds.has(n.id));return e.length===0?null:e[Math.floor(Math.random()*e.length)]}submitAnswer(t,e){const n=e===t.correctIndex;this.askedQuestionIds.add(t.id),this.answers.push({questionId:t.id,level:t.level,isCorrect:n});const o=u[this.currentLevel];return n?o<h.length-1&&(this.currentLevel=h[o+1]):o>0&&(this.currentLevel=h[o-1]),this.timeline.push(this.currentLevel),{isCorrect:n,correctIndex:t.correctIndex,explain:t.explain}}shouldStop(){const t=this.answers.length;if(t<I)return!1;if(t>=v)return!0;if(t>=_){const e=this.timeline.slice(-_),n={};e.forEach(i=>{n[i]=(n[i]||0)+1});let o=null,a=0;for(const[i,l]of Object.entries(n))l>a&&(a=l,o=i);if(a>=L){const i=u[o];if(e.every(d=>{const p=u[d];return Math.abs(p-i)<=1}))return this.earlyStop=!0,!0}}return!1}calculateFinalLevel(){const t={};this.answers.forEach(i=>{t[i.level]=(t[i.level]||0)+1});let e=[],n=0;for(const[i,l]of Object.entries(t))l>n?(n=l,e=[i]):l===n&&e.push(i);if(e.length>1){const i=this.answers[this.answers.length-1];e.sort((l,d)=>u[l]-u[d]),i.isCorrect?this.finalLevel=e[e.length-1]:this.finalLevel=e[0]}else this.finalLevel=e[0];let a=this.answers.filter(i=>i.isCorrect).length/this.answers.length;this.earlyStop&&(a+=.05),this.confidence=Math.max(0,Math.min(1,a))}getResults(){return{level:this.finalLevel,confidence:this.confidence,totalAsked:this.answers.length,correctCount:this.answers.filter(t=>t.isCorrect).length,askedQuestionIds:Array.from(this.askedQuestionIds),timeline:this.timeline,earlyStop:this.earlyStop}}getProgress(){return{current:this.answers.length,min:I,max:v,percentage:Math.min(100,Math.round(this.answers.length/v*100))}}async saveResults(){const t=w.currentUser;if(!t)throw new Error("Not authenticated");const e=this.getResults(),n=C(q,"users",t.uid);return await E(n,{hasPlacement:!0,level:e.level,placementScore:Math.round(e.confidence*100),placementTakenAt:S(),placementHistory:{totalAsked:e.totalAsked,correctCount:e.correctCount,confidence:e.confidence,timeline:e.timeline,askedQuestionIds:e.askedQuestionIds,earlyStop:e.earlyStop}},{merge:!0}),e}}T();let r=null,c=null,x=null;const f=document.getElementById("test-intro"),y=document.getElementById("test-content"),N=document.getElementById("test-results"),g=document.getElementById("loading-overlay"),Q=document.getElementById("start-test-btn"),b=document.getElementById("next-btn"),M=document.getElementById("go-dashboard-btn"),W={A1:"Beginner - You can understand and use basic everyday expressions. Start with fundamentals!",A2:"Elementary - You can communicate in simple tasks and describe your background. Build your foundation!",B1:"Intermediate - You can handle most travel situations and describe experiences. Keep improving!",B2:"Upper Intermediate - You can interact fluently with native speakers. Almost there!",C1:"Advanced - You can use English effectively for professional and academic purposes. Excellent!"};Q.addEventListener("click",()=>{try{if(r=new H,!f||!y)throw new Error("DOM elements missing");f.classList.add("hidden"),y.classList.remove("hidden"),k()}catch(s){console.error("Failed to start test:",s),alert("Oops! Something went wrong while starting the test. Please check the console.")}});function k(){try{if(c=r.getNextQuestion(),x=null,!c){O();return}const s=r.getProgress();document.getElementById("question-count").textContent=`Question ${s.current+1}`,document.getElementById("progress-fill").style.width=`${s.percentage}%`,document.getElementById("level-indicator").textContent=`Level: ${r.currentLevel}`,document.getElementById("level-indicator").className=`level-indicator level-${r.currentLevel.toLowerCase()}`,document.getElementById("skill-tag").textContent=c.skill.charAt(0).toUpperCase()+c.skill.slice(1),document.getElementById("question-text").textContent=c.question;const t=document.getElementById("choices-container");t.innerHTML="",c.choices.forEach((e,n)=>{const o=document.createElement("button");o.className="choice-btn",o.innerHTML=`<span class="choice-letter">${String.fromCharCode(65+n)}</span>${e}`,o.addEventListener("click",()=>P(n,o)),t.appendChild(o)}),document.getElementById("feedback-section").classList.add("hidden")}catch(s){console.error("Error in showNextQuestion:",s),alert("An error occurred during the test. Please refresh the page.")}}function P(s,t){if(x!==null)return;x=s,document.querySelectorAll(".choice-btn").forEach(p=>p.disabled=!0);const e=r.submitAnswer(c,s);document.querySelectorAll(".choice-btn")[e.correctIndex].classList.add("correct"),s!==e.correctIndex&&t.classList.add("wrong");const o=document.getElementById("feedback-section"),a=document.getElementById("feedback-icon"),i=document.getElementById("feedback-text"),l=document.getElementById("explanation");o.classList.remove("hidden"),a.textContent=e.isCorrect?"✅":"❌",i.textContent=e.isCorrect?"Correct!":"Incorrect",i.className=`feedback-text ${e.isCorrect?"correct":"wrong"}`,l.textContent=e.explain;const d=r.getProgress();b.textContent=d.current>=d.min&&r.shouldStop()?"See Results":"Next Question"}b.addEventListener("click",k);async function O(){y.classList.add("hidden"),g.classList.remove("hidden");try{const s=await r.saveResults();g.classList.add("hidden"),N.classList.remove("hidden"),document.getElementById("result-level").textContent=s.level,document.getElementById("result-level").className=`level-value level-${s.level.toLowerCase()}`;const t=Math.round(s.correctCount/s.totalAsked*100);document.getElementById("result-score").textContent=`${t}%`,document.getElementById("result-confidence").textContent=`${Math.round(s.confidence*100)}%`,document.getElementById("result-questions").textContent=s.totalAsked,document.getElementById("level-description").textContent=W[s.level]||""}catch(s){console.error("Error saving results:",s),g.style.display="none",alert("Error saving results. Please try again.")}}M.addEventListener("click",()=>{window.location.href="/dashboard.html"});A(async s=>{if(s){const t=await B(s.uid);t&&t.hasPlacement&&(window.location.href="/dashboard.html")}});
